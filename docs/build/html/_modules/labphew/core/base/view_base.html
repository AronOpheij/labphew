

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>labphew.core.base.view_base &mdash; labphew 0.3.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> labphew
          

          
          </a>

          
            
            
              <div class="version">
                0.3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Further in the docs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction to labphew</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">How to install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../howtolabphew.html">How to labphew</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../walkthrough.html">A short guided tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../labphew.model.html">M for model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../labphew.view.html">V for view</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../labphew.controller.html">C for controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../labphew.core.html">The core files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../labphew.logging.html">Logging and debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Simple examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devices.html">Supported devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../customize.html">Customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contribute.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api.html">API documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">labphew</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>labphew.core.base.view_base</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for labphew.core.base.view_base</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding=utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">View Base Classes</span>
<span class="sd">=================</span>

<span class="sd">Base class for View Windows.</span>
<span class="sd">- When the object of the child class is created the base class checks if required and recommended methods are present</span>
<span class="sd">  in the child class (and in the base class itself).</span>
<span class="sd">- By inheriting, methods from this base class will be used if they are missing in the child class. This allows to</span>
<span class="sd">  implement some fallback functionality and to warn the user.</span>
<span class="sd">- In addition it implements the __enter__ and __exit__ methods to allow the class to be used in a python with block.</span>

<span class="sd">Example usage can be found at the bottom of the file under if __name__==&#39;__main___&#39;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">labphew</span>
<span class="kn">from</span> <span class="nn">labphew.core.base.tools</span> <span class="kn">import</span> <span class="n">check_method_presence_and_warn</span>
<span class="kn">from</span> <span class="nn">labphew.core.tools.gui_tools</span> <span class="kn">import</span> <span class="n">fit_on_screen</span><span class="p">,</span> <span class="n">ModifyConfig</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QAction</span>

<div class="viewcode-block" id="MonitorWindowBase"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.MonitorWindowBase">[docs]</a><span class="k">class</span> <span class="nc">MonitorWindowBase</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get&#39;s called before the object (of the child class) is created and warns if required or</span>
<span class="sd">        recommended methods are missing in that class.</span>
<span class="sd">        Note that required and recommended methods may exist in this Base class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;__init__&#39;</span><span class="p">]</span>
        <span class="n">recommended</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;closeEvent&#39;</span><span class="p">,</span> <span class="s1">&#39;load_scan_guis&#39;</span><span class="p">,</span> <span class="s1">&#39;open_scan_window&#39;</span><span class="p">,</span> <span class="s1">&#39;start_monitor&#39;</span><span class="p">,</span> <span class="s1">&#39;stop_monitor&#39;</span><span class="p">,</span> <span class="s1">&#39;update_monitor&#39;</span><span class="p">]</span>
        <span class="n">check_method_presence_and_warn</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">required</span><span class="p">,</span> <span class="n">recommended</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

<div class="viewcode-block" id="MonitorWindowBase.__init__"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.MonitorWindowBase.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>  <span class="c1"># creating a logger (just in case)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span></div>

<div class="viewcode-block" id="MonitorWindowBase.closeEvent"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.MonitorWindowBase.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets called when the window is closed. Could be used to do some cleanup before closing. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class doesn&#39;t have a closeEvent method (using the method from MonitorWindowBase)&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_monitor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">scan_win</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_windows</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">scan_win</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">disconnect_devices</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>

    <span class="c1"># the next two methods are needed so the context manager &#39;with&#39; works.</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method get&#39;s called when exiting a python with block (when the code completed but also when an error occured)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Calling disconnect_devices() before exiting with block&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_devices</span><span class="p">()</span>

    <span class="c1"># It is actually fine to use this method from te base class and not re-implement it in your own</span>
<div class="viewcode-block" id="MonitorWindowBase.load_scan_guis"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.MonitorWindowBase.load_scan_guis">[docs]</a>    <span class="k">def</span> <span class="nf">load_scan_guis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_windows</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load scan windows and add them to a menu in this monitor window.</span>
<span class="sd">        Note that the scan windows should be instantiated before adding them.</span>
<span class="sd">        The keys of the dictionary should be strings that will act as the names in the Scan menu.</span>
<span class="sd">        The values of the dictionary could be the ScanWindowObjects or a list that also contains some PyQt gui settings</span>
<span class="sd">        in a dictionary: [ScanWindowObject, {&#39;shortcut&#39;:&quot;Ctrl+Shift+V&quot;, &#39;statusTip&#39;:&#39;Voltage sweep scan&#39;}]</span>

<span class="sd">        :param scan_windows: scan windows dict</span>
<span class="sd">        :type scan_windows: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scanMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainMenu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s1">&#39;&amp;Scans&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">scan_lst</span> <span class="ow">in</span> <span class="n">scan_windows</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">scan_lst</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">scan_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">scan_lst</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scan_lst</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">scan_lst</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_windows</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_lst</span>
            <span class="n">scanMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">QAction</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">open_scan_window</span><span class="p">,</span> <span class="o">**</span><span class="n">scan_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span></div>

    <span class="c1"># It is actually fine to use this method from te base class and not re-implement it in your own</span>
<div class="viewcode-block" id="MonitorWindowBase.open_scan_window"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.MonitorWindowBase.open_scan_window">[docs]</a>    <span class="k">def</span> <span class="nf">open_scan_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called by the menu and opens Scan Windows that were &quot;attached&quot; to this Monitor gui with load_scan_guis().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_monitor</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>  <span class="c1"># get the name of the QAction (which is also the key of the scanwindow dictionary)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Opening scan window </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_windows</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">fit_on_screen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_windows</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="MonitorWindowBase.start_monitor"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.MonitorWindowBase.start_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">start_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using start_monitor method from MonitorWindowBase, it&#39;s strongly recommended that you create a start_monitor method in your </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_busy</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Operator is busy&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Starting monitor&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_allow_monitor</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># enable operator monitor loop to run</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">monitor_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># start the operator monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">monitor_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;monitor&#39;</span><span class="p">][</span><span class="s1">&#39;gui_refresh_time&#39;</span><span class="p">])</span>  <span class="c1"># start the update timer</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="MonitorWindowBase.stop_monitor"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.MonitorWindowBase.stop_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">stop_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using stop_monitor method from MonitorWindowBase, it&#39;s strongly recommended that you create a stop_monitor method in your </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_thread</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Monitor is not running&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># set flag to to tell the operator to stop:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Stopping monitor&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_stop</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">monitor_thread</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;monitor&#39;</span><span class="p">][</span><span class="s1">&#39;stop_timeout&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_allow_monitor</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># disable monitor again</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_busy</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Reset in case the monitor was not stopped gracefully, but forcefully stopped</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="MonitorWindowBase.update_monitor"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.MonitorWindowBase.update_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">update_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;update_monitor method is missing in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class.&quot;</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="ScanWindowBase"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.ScanWindowBase">[docs]</a><span class="k">class</span> <span class="nc">ScanWindowBase</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get&#39;s called before the object (of the child class) is created and warns if required or</span>
<span class="sd">        recommended methods are missing in that class.</span>
<span class="sd">        Note that required and recommended methods may exist in this Base class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;__init__&#39;</span><span class="p">]</span>
        <span class="n">recommended</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;closeEvent&#39;</span><span class="p">,</span> <span class="s1">&#39;mod_scan_config&#39;</span><span class="p">,</span> <span class="s1">&#39;reset_fields&#39;</span><span class="p">,</span> <span class="s1">&#39;start_scan&#39;</span><span class="p">,</span> <span class="s1">&#39;pause_scan&#39;</span><span class="p">,</span> <span class="s1">&#39;stop_scan&#39;</span><span class="p">,</span> <span class="s1">&#39;kill_scan&#39;</span><span class="p">,</span> <span class="s1">&#39;update_scan&#39;</span><span class="p">]</span>
        <span class="n">check_method_presence_and_warn</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">required</span><span class="p">,</span> <span class="n">recommended</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

<div class="viewcode-block" id="ScanWindowBase.__init__"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.ScanWindowBase.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>  <span class="c1"># creating a logger (just in case)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScanWindowBase.closeEvent"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.ScanWindowBase.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets called when the window is closed. Could be used to do some cleanup before closing. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class doesn&#39;t have a closeEvent method (using the method from ScanWindowBase)&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_scan</span><span class="p">()</span>  <span class="c1"># stop scan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>

    <span class="c1"># the next two methods are needed so the context manager &#39;with&#39; works.</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method get&#39;s called when exiting a python with block (when the code completed but also when an error occured)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Calling disconnect_devices() before exiting with block&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_devices</span><span class="p">()</span>

    <span class="c1"># It&#39;s kind of ok to inherit this as long as your callback method is called apply_properties (if you need a callback)</span>
<div class="viewcode-block" id="ScanWindowBase.mod_scan_config"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.ScanWindowBase.mod_scan_config">[docs]</a>    <span class="k">def</span> <span class="nf">mod_scan_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class is missing the the recommended mod_scan_config method.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;apply_properties&#39;</span><span class="p">):</span>
            <span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_properties</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">callback</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">conf_win</span> <span class="o">=</span> <span class="n">ModifyConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">],</span> <span class="n">apply_callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">conf_win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanWindowBase.reset_fields"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.ScanWindowBase.reset_fields">[docs]</a>    <span class="k">def</span> <span class="nf">reset_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class is missing the the reset_fields method. Use that to reset gui elements and flags after a scan&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_busy</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_pause</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_stop</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ScanWindowBase.start_scan"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.ScanWindowBase.start_scan">[docs]</a>    <span class="k">def</span> <span class="nf">start_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;start_scan method is missing in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_busy</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Operator is busy&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Starting scan&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scan_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># start the operator monitor</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">][</span><span class="s1">&#39;gui_refresh_time&#39;</span><span class="p">])</span>  <span class="c1"># start the update timer</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scan_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># start the update timer</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="ScanWindowBase.pause_scan"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.ScanWindowBase.pause_scan">[docs]</a>    <span class="k">def</span> <span class="nf">pause_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pause_scan method is missing in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_pause</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_pause</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="ScanWindowBase.stop_scan"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.ScanWindowBase.stop_scan">[docs]</a>    <span class="k">def</span> <span class="nf">stop_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stop_scan method is missing in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Stopping operator&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_stop</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_thread</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scan_thread</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">][</span><span class="s1">&#39;stop_timeout&#39;</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_busy</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Reset in case the monitor was not stopped gracefully, but forcefully stopped</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_fields</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="ScanWindowBase.kill_scan"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.ScanWindowBase.kill_scan">[docs]</a>    <span class="k">def</span> <span class="nf">kill_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;kill_scan method is missing in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">_stop</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_thread</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_fields</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="ScanWindowBase.update_scan"><a class="viewcode-back" href="../../../../core/base.html#labphew.core.base.view_base.ScanWindowBase.update_scan">[docs]</a>    <span class="k">def</span> <span class="nf">update_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;update_scan method is missing in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class.&quot;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Sanli Faez

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>